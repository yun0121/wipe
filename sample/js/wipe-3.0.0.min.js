/*!wipe-hog 3.0.0 发布日期:2018-11-19*/
function Wipe(t){this.conID=t.id,this.color=t.color||"#666",this.percents=t.percents,this.cas=document.getElementById(this.conID),this.context=this.cas.getContext("2d"),this.coverType=t.coverType,this.cas.style.background="url("+t.backImgUrl+")center no-repeat",this.cas.style.backgroundSize="100% 100%",this.imgUrl=t.imgUrl,this.cas.width=t.width,this.cas.height=t.height,this._w=this.cas.width,this._h=this.cas.height,this.radius=t.radius,this.x1=0,this.y1=0,this.isMouseDown=!1,this.wipeCallback=t.wipeCallback,this.drawMask(),this.play()}function getAllLeft(t){for(var e=0;t;)e+=t.offsetLeft,t=t.offsetParent;return e}function getAllTop(t){for(var e=0;t;)e+=t.offsetTop,t=t.offsetParent;return e}Wipe.prototype.drawMask=function(){if(""===this.coverType)this.context.fillStyle="#666",this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else if("images"===this.coverType){this.img=new Image,this.img.src=this.imgUrl,console.log(this.img);var t=this;this.img.onload=function(){t.context.drawImage(t.img,0,0,t.img.width,t.img.height,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.draw=function(t,e,i,o){var s=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;2===arguments.length?(this.context.beginPath(),this.context.arc(t+n,e+s,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill()):(this.context.save(),this.context.beginPath(),this.context.lineCap="round",this.context.lineWidth=2*this.radius,this.context.moveTo(t+n,e+s),this.context.lineTo(i+n,o+s),this.context.stroke(),this.context.restore())},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTranspar=function(){var t=0,e=this.context.getImageData(0,0,this._w,this._h);console.log(e);for(var i=0;i<this._h;i++)for(var o=0;o<this._w;o++){this._w,this._w,this._w;var s=4*(this._w*i+o)+3;0===e.data[s]&&t++}return this.tmb=t/(this._w*this._h)*100,console.log(this.tmb),Math.round(this.tmb)},Wipe.prototype.play=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.press=this.device?"touchstart":"mousedown",this.move=this.device?"touchmove":"mousemove",this.loosen=this.device?"touchend":"mouseup";var o=this;this.cas.addEventListener(this.press,function(t){o.isMouseDown=!0,console.log(o.isMouseDown),o.device?(o.x1=event.touches[0].clientX,o.y1=event.touches[0].clientY):(o.x1=event.clientX,o.y1=event.clientY),console.log(o.x1),console.log(o.y1),o.draw(o.x1-getAllLeft(o.cas),o.y1-getAllTop(o.cas))},!1),this.cas.addEventListener(this.move,function(t){if(o.isMouseDown){o.event=t||window.event,o.event.preventDefault();var e=o.device?event.touches[0].clientX:event.clientX,i=o.device?event.touches[0].clientY:event.clientY;o.draw(o.x1-getAllLeft(o.cas),o.y1-getAllTop(o.cas),e-getAllLeft(o.cas),i-getAllTop(o.cas)),o.x1=e,o.y1=i}},!1),this.cas.addEventListener(this.loosen,function(){o.isMouseDown=!1;var t=o.getTranspar();o.wipeCallback.call(window,t),t>o.percents&&o.clearRect(),console.log(o.isMouseDown)},!1)};